!function(){"use strict";const t=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function e(t){let e="";for(let i=0;i<t;++i)i>0&&(e+="\nelse "),i<t-1&&(e+=`if(test == ${i}.0){}`);return e}const i={fragmentShader:"\nprecision highp float;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nuniform sampler2D uTexture[%count%];\n\nvoid main (void)\n{\n    vec4 color;\n\n    %forloop%\n\n    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\n}",vertexShader:"\nprecision highp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute float aTextureId;\nattribute vec4 aTintColor;\n\nuniform mat4 uProjectionMatrix;\nuniform mat4 uCameraMatrix;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nvoid main (void)\n{\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vTintColor = aTintColor;\n\n    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\n}"};class r{constructor(t,e={}){this.renderer=t,this.gl=t.gl;const{batchSize:r=4096,dataSize:s=4,indexSize:n=4,vertexElementSize:h=6,quadIndexSize:a=6,fragmentShader:o=i.fragmentShader,vertexShader:c=i.vertexShader}=e;this.batchSize=r,this.dataSize=s,this.indexSize=n,this.vertexElementSize=h,this.vertexByteSize=h*s,this.quadByteSize=4*this.vertexByteSize,this.quadElementSize=4*h,this.quadIndexSize=a,this.bufferByteSize=r*this.quadByteSize,this.createBuffers(),this.createShaders(o,c)}createBuffers(){let t=[];for(let e=0;e<this.batchSize*this.indexSize;e+=this.indexSize)t.push(e+0,e+1,e+2,e+2,e+3,e+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(t),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const e=this.gl;this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.data,e.DYNAMIC_DRAW),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.index,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),t=[]}createShaders(t,e){const i=this.gl,r=this.renderer.maxTextures;let s="";for(let t=0;t<r;t++)t>0&&(s+="\n    else "),t<r-1&&(s+=`if (vTextureId < ${t}.5)`),s+="\n    {",s+=`\n        color = texture2D(uTexture[${t}], vTextureCoord);`,s+="\n    }";t=(t=t.replace(/%count%/gi,`${r}`)).replace(/%forloop%/gi,s);const n=i.createShader(i.FRAGMENT_SHADER);i.shaderSource(n,t),i.compileShader(n);const h=i.createShader(i.VERTEX_SHADER);i.shaderSource(h,e),i.compileShader(h);const a=i.createProgram();i.attachShader(a,h),i.attachShader(a,n),i.linkProgram(a),i.useProgram(a),this.program=a;const o=i.getAttribLocation(a,"aVertexPosition"),c=i.getAttribLocation(a,"aTextureCoord"),u=i.getAttribLocation(a,"aTextureId"),d=i.getAttribLocation(a,"aTintColor"),l=i.getUniformLocation(a,"uProjectionMatrix"),x=i.getUniformLocation(a,"uCameraMatrix"),f=i.getUniformLocation(a,"uTexture");i.enableVertexAttribArray(o),i.enableVertexAttribArray(c),i.enableVertexAttribArray(u),i.enableVertexAttribArray(d),this.attribs={position:o,textureCoord:c,textureIndex:u,color:d},this.uniforms={projectionMatrix:l,cameraMatrix:x,textureLocation:f}}bind(t){const e=this.gl,i=this.renderer,r=this.uniforms;e.useProgram(this.program),e.uniformMatrix4fv(r.projectionMatrix,!1,i.projectionMatrix),e.uniformMatrix4fv(r.cameraMatrix,!1,t.matrix),e.uniform1iv(r.textureLocation,i.textureIndex),this.bindBuffers(this.indexBuffer,this.vertexBuffer)}bindBuffers(t,e){const i=this.gl,r=this.vertexByteSize,s=this.attribs;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),i.bindBuffer(i.ARRAY_BUFFER,e),i.vertexAttribPointer(s.position,2,i.FLOAT,!1,r,0),i.vertexAttribPointer(s.textureCoord,2,i.FLOAT,!1,r,8),i.vertexAttribPointer(s.textureIndex,1,i.FLOAT,!1,r,16),i.vertexAttribPointer(s.color,4,i.UNSIGNED_BYTE,!0,r,20),this.count=0}batchSpriteBuffer(t){return t.size>0&&(this.flush(),t.render(),this.bindBuffers(this.indexBuffer,this.vertexBuffer),!0)}batchSprite(t){this.count===this.batchSize&&this.flush(),t.updateVertices(this.vertexViewF32,this.vertexViewU32,this.count*this.quadElementSize),this.count++}flush(){const t=this.count;if(0===t)return;const e=this.gl,i=t*this.quadByteSize;if(i===this.bufferByteSize)e.bufferData(e.ARRAY_BUFFER,this.data,e.DYNAMIC_DRAW);else{let t=this.vertexViewF32.subarray(0,i);e.bufferSubData(e.ARRAY_BUFFER,0,t)}e.drawElements(e.TRIANGLES,t*this.quadIndexSize,e.UNSIGNED_SHORT,0),this.count=0}}class s{constructor(t,e,i=1){this.contextOptions={alpha:!1,antialias:!1,premultipliedAlpha:!1,stencil:!1,preserveDrawingBuffer:!1},this.clearColor=[0,0,0,1],this.maxTextures=0,this.clearBeforeRender=!0,this.optimizeRedraw=!0,this.autoResize=!0,this.contextLost=!1,this.width=t,this.height=e,this.resolution=i;const s=document.createElement("canvas");s.addEventListener("webglcontextlost",t=>this.onContextLost(t),!1),s.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=s,this.initContext(),this.shader=new r(this)}initContext(){const t=this.canvas.getContext("webgl",this.contextOptions);this.gl=t,this.elementIndexExtension=t.getExtension("OES_element_index_uint"),this.getMaxTextures(),this.shader&&(this.shader.gl=t),this.resize(this.width,this.height,this.resolution)}resize(t,e,i=1){this.width=t*i,this.height=e*i,this.resolution=i;const r=this.canvas;r.width=this.width,r.height=this.height,this.autoResize&&(r.style.width=this.width/i+"px",r.style.height=this.height/i+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=this.ortho(t,e,-1e4,1e4)}ortho(t,e,i,r){return new Float32Array([1/-t*-2,0,0,0,0,1/e*-2,0,0,0,0,1/(i-r)*2,0,-1,1,0,1])}onContextLost(t){t.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(t){const e=this.clearColor,i=t>>16&255,r=t>>8&255,s=255&t,n=t>16777215?t>>>24:255;return e[0]=i/255,e[1]=r/255,e[2]=s/255,e[3]=n/255,this}getMaxTextures(){const i=this.gl;let r=function(i,r){const s=r.createShader(r.FRAGMENT_SHADER);for(;;){const n=t.replace(/%forloop%/gi,e(i));if(r.shaderSource(s,n),r.compileShader(s),r.getShaderParameter(s,r.COMPILE_STATUS))break;i=i/2|0}return i}(i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),i);for(let t=0;t<r;t++){let e=i.createTexture();i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,e),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array([0,0,255,255]))}this.maxTextures=r,this.textureIndex=Array.from(Array(r).keys()),this.activeTextures=Array(r),this.currentActiveTexture=0,this.startActiveTexture=0}isSizePowerOfTwo(t,e){return!(t<1||e<1)&&(0==(t&t-1)&&0==(e&e-1))}createGLTexture(t){const e=this.gl,i=e.createTexture();e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);const r=this.isSizePowerOfTwo(t.width,t.height),s=r?e.REPEAT:e.CLAMP_TO_EDGE;return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,s),r&&e.generateMipmap(e.TEXTURE_2D),i}render(t,e,i){if(this.contextLost)return;const r=this.gl;if(r.bindFramebuffer(r.FRAMEBUFFER,null),this.optimizeRedraw&&0===i)return;this.currentActiveTexture=0,this.startActiveTexture++;const s=this.shader;r.viewport(0,0,this.width,this.height),r.enable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA);const n=this.clearColor;this.clearBeforeRender&&(r.clearColor(n[0],n[1],n[2],n[3]),r.clear(r.COLOR_BUFFER_BIT)),s.bind(e);const h=this.maxTextures,a=this.activeTextures,o=this.startActiveTexture;for(let e=0;e<t.length;e++){let i=t[e],n=i.texture;n.glIndexCounter<o&&(n.glIndexCounter=o,this.currentActiveTexture<h&&(a[this.currentActiveTexture]=n,n.glIndex=this.currentActiveTexture,r.activeTexture(r.TEXTURE0+this.currentActiveTexture),r.bindTexture(r.TEXTURE_2D,n.glTexture),this.currentActiveTexture++)),s.batchSprite(i)}s.flush()}}class n{constructor(t,e,i,r,s){this.hasLoaded=!1,this.type=t,this.key=e,this.url=i,this.loadHandler=r,this.config=s}}class h{constructor(t){this.baseURL="",this.path="",this.crossOrigin=void 0,this.maxParallelDownloads=32,this.isLoading=!1,this.game=t,this.reset()}reset(){this.isLoading=!1,this.queue=[],this.inflight=new Map}start(t){this.isLoading||(this.queue.length>0?(this.isLoading=!0,this.onComplete=t,this.nextFile()):t())}nextFile(){if(this.queue.length){let t=this.queue.shift();this.inflight.set(t.url,t),t.loadHandler(t)}else 0===this.inflight.size&&this.stop()}stop(){this.isLoading=!1,this.onComplete()}fileComplete(t){if(t.linkFile&&t.linkFile.hasLoaded){const e="atlasimage"===t.type?t:t.linkFile,i="atlasjson"===t.type?t:t.linkFile;this.game.textures.addAtlas(t.key,e.data,i.data)}this.inflight.delete(t.url),this.nextFile()}fileError(t){this.inflight.delete(t.url),this.nextFile()}totalFilesToLoad(){return this.queue.length+this.inflight.size}image(t,e){let i=new n("image",t,this.getURL(t,e,".png"),t=>this.imageTagLoader(t));return this.queue.push(i),this}spritesheet(t,e,i){let r=new n("spritesheet",t,this.getURL(t,e,".png"),t=>this.imageTagLoader(t));return r.config=i,this.queue.push(r),this}atlas(t,e,i){let r=new n("atlasimage",t,this.getURL(t,e,".png"),t=>this.imageTagLoader(t)),s=new n("atlasjson",t,this.getURL(t,i,".json"),t=>this.XHRLoader(t));return s.config={responseType:"text"},r.linkFile=s,s.linkFile=r,this.queue.push(r),this.queue.push(s),this}json(t,e){let i=new n("json",t,this.getURL(t,e,".json"),t=>this.XHRLoader(t));return i.config={responseType:"text"},this.queue.push(i),this}csv(t,e){let i=new n("csv",t,this.getURL(t,e,".csv"),t=>this.XHRLoader(t));return i.config={responseType:"text"},this.queue.push(i),this}XHRLoader(t){const e=new XMLHttpRequest;e.open("GET",t.url,!0),e.responseType=t.config.responseType,e.onload=i=>{t.hasLoaded=!0,"json"===t.type||"atlasjson"===t.type?t.data=JSON.parse(e.responseText):t.data=e.responseText,this.fileComplete(t)},e.onerror=()=>{t.hasLoaded=!0,this.fileError(t)},e.send()}imageTagLoader(t){t.data=new Image,this.crossOrigin&&(t.data.crossOrigin=this.crossOrigin),t.data.onload=()=>{t.data.onload=null,t.data.onerror=null,t.hasLoaded=!0,"image"===t.type?this.game.textures.addImage(t.key,t.data):"spritesheet"===t.type&&this.game.textures.addSpriteSheet(t.key,t.data,t.config),this.fileComplete(t)},t.data.onerror=()=>{t.data.onload=null,t.data.onerror=null,t.hasLoaded=!0,this.fileError(t)},t.data.src=t.url,t.data.complete&&t.data.width&&t.data.height&&(t.data.onload=null,t.data.onerror=null,t.hasLoaded=!0,"image"===t.type?this.game.textures.addImage(t.key,t.data):"spritesheet"===t.type&&this.game.textures.addSpriteSheet(t.key,t.data,t.config),this.fileComplete(t))}getURL(t,e,i){return e||(e=t+i),this.baseURL+this.path+e}setBaseURL(t){return""!==t&&"/"!==t.substr(-1)&&(t=t.concat("/")),this.baseURL=t,this}setPath(t){return""!==t&&"/"!==t.substr(-1)&&(t=t.concat("/")),this.path=t,this}setCORS(t){return this.crossOrigin=t,this}}function a(t,e){let i=t;return e.forEach(t=>{i=t(i)}),i}function o(t){return class extends t{constructor(){super(...arguments),this._alpha=1}setAlpha(t=1){return t!==this._alpha&&(this._alpha=t,this.setDirty()),this}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.setDirty())}}}function c(t){return class extends t{constructor(...t){super(t),this.children=[],this.isParent=!0}getChildren(){return this.children}addChild(...t){return t.forEach(t=>{this.addChildAt(t,this.children.length)}),this}addChildAt(t,e){return e>=0&&e<=this.children.length&&(t.parent&&t.parent.removeChild(t),t.setParent(this),this.children.splice(e,0,t),t.updateTransform()),t}swapChildren(t,e){if(t===e)return this;const i=this.getChildIndex(t),r=this.getChildIndex(e);if(i<0||r<0)throw new Error("swap: Both children must belong to the same parent");return this.children[i]=e,this.children[r]=t,this}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("Supplied DisplayObject not child of the caller");return e}setChildIndex(t,e){const i=this.children;if(e<0||e>=i.length)throw new Error("Index "+e+" out of bounds");const r=this.getChildIndex(t);return i.splice(r,1),i.splice(e,0,t),this}getChildAt(t){if(t<0||t>=this.numChildren)throw new Error("Index "+t+" out of bounds");return this.children[t]}removeChild(t){const e=this.children.indexOf(t);if(-1!==e)return this.removeChildAt(e)}removeChildAt(t){const e=this.getChildAt(t);return e&&(e.parent=void 0,e.updateTransform(),this.children.splice(t,1)),e}removeChildren(t=0,e){const i=this.children;void 0===e&&(e=i.length);const r=e-t;if(r>0&&r<=e){const e=i.splice(t,r);return e.forEach(t=>{t.parent=void 0,t.updateTransform()}),e}if(0===r&&0===i.length)return[];throw new Error("Range Error. Values out of bounds")}update(t,e){const i=this.children;for(let r=0;r<i.length;r++)i[r].update(t,e)}get numChildren(){return this.children.length}}}function u(t){return class extends t{constructor(){super(...arguments),this.dirty=!0,this.dirtyFrame=0}setDirty(t=!0){return this.dirty=!0,t&&(this.dirtyFrame=this.scene.game.frame),this}}}class d{constructor(t=0,e=0){this.set(t,e)}set(t=0,e=0){return this.x=t,this.y=e,this}zero(){return this.set()}getArray(){return[this.x,this.y]}fromArray(t){return this.set(t[0],t[1])}[Symbol.iterator](){return this.getArray()[Symbol.iterator]()}}function l(t){return class extends t{constructor(){super(...arguments),this._origin=new d(.5,.5)}setOrigin(t,e=t){return this._origin.set(t,e),this}get originX(){return this._origin.x}set originX(t){this._origin.x=t}get originY(){return this._origin.y}set originY(t){this._origin.y=t}}}function x(t){return class extends t{constructor(){super(...arguments),this.isParent=!1}setParent(t){return this.parent=t,this}update(t,e){}}}function f(t){return class extends t{constructor(){super(...arguments),this._position=new d}setPosition(t,e=t){return this._position.set(t,e),this.updateTransform()}set x(t){this._position.x=t,this.updateTransform()}get x(){return this._position.x}set y(t){this._position.y=t,this.updateTransform()}get y(){return this._position.y}}}function g(t){return class extends t{constructor(...t){super(t),this._alpha=1,this.vertexAlpha=new Float32Array(4).fill(1)}setAlpha(t=1,e=t,i=t,r=t){const s=this.vertexAlpha;return s[0]=t,s[1]=e,s[2]=i,s[3]=r,this.packColors()}get alpha(){return this._alpha}set alpha(t){this._alpha=t,this.setAlpha(t)}}}function p(t){return class extends t{constructor(...t){super(t),this._tint=16777215,this.vertexTint=new Uint32Array(4).fill(16777215)}setTint(t=16777215,e=t,i=t,r=t){const s=this.vertexTint;return s[0]=t,s[1]=e,s[2]=i,s[3]=r,this.packColors()}get tint(){return this._tint}set tint(t){this._tint=t,this.setTint(t)}}}function m(t){return class extends t{constructor(){super(...arguments),this.renderable=!0}setRenderable(t){return this.renderable=t,this}willRender(){return this.visible&&this.renderable&&this.alpha>0&&this.hasTexture}}}function T(t){return class extends t{constructor(){super(...arguments),this._rotation=0}setRotation(t){return t!==this._rotation&&(this._rotation=t,this.updateCache()),this}set rotation(t){t!==this._rotation&&(this._rotation=t,this.updateCache())}get rotation(){return this._rotation}}}function v(t){return class extends t{constructor(){super(...arguments),this._scale=new d(1,1)}setScale(t,e=t){return this._scale.set(t,e),this.updateCache()}set scaleX(t){t!==this._scale.x&&(this._scale.x=t,this.updateCache())}get scaleX(){return this._scale.x}set scaleY(t){t!==this._scale.y&&(this._scale.y=t,this.updateCache())}get scaleY(){return this._scale.y}}}function A(t){return class extends t{setScene(t){return this.scene=t,this}}}function w(t){return class extends t{setSize(t,e){return this.width=t,this.height=e,this}}}function S(t){return class extends t{constructor(){super(...arguments),this._skew=new d(0,0)}setSkew(t,e=t){return this._skew.set(t,e),this.updateCache()}set skewX(t){t!==this._skew.x&&(this._skew.x=t,this.updateCache())}get skewX(){return this._skew.x}set skewY(t){t!==this._skew.y&&(this._skew.y=t,this.updateCache())}get skewY(){return this._skew.y}}}class y{constructor(t,e,i,r,s,n){this.trimmed=!1,this.texture=t,this.key=e,this.x=i,this.y=r,this.width=s,this.height=n,this.sourceSizeWidth=s,this.sourceSizeHeight=n,this.updateUVs()}setPivot(t,e){this.pivot={x:t,y:e}}setSourceSize(t,e){this.sourceSizeWidth=t,this.sourceSizeHeight=e}setTrim(t,e,i,r,s,n){this.trimmed=!0,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.spriteSourceSizeX=i,this.spriteSourceSizeY=r,this.spriteSourceSizeWidth=s,this.spriteSourceSizeHeight=n}updateUVs(){const{x:t,y:e,width:i,height:r}=this,s=this.texture.width,n=this.texture.height;this.u0=t/s,this.v0=e/n,this.u1=(t+i)/s,this.v1=(e+r)/n}}class E{constructor(t,e){this.glIndex=0,this.glIndexCounter=-1,this.key=t,this.image=e,this.width=e.width,this.height=e.height,this.frames=new Map,this.add("__BASE",0,0,e.width,e.height)}add(t,e,i,r,s){if(this.frames.has(t))return null;let n=new y(this,t,e,i,r,s);return this.frames.set(t,n),this.firstFrame&&"__BASE"!==this.firstFrame.key||(this.firstFrame=n),n}get(t){if(!t)return this.firstFrame;t instanceof y&&(t=t.key);let e=this.frames.get(t);return e||(console.warn("Texture.frame missing: "+t),e=this.firstFrame),e}getFrames(t){const e=[];return t.forEach(t=>{e.push(this.get(t))}),e}getFramesInRange(t,e,i,r=0,s=""){const n=[],h=e<i?1:-1;i+=h;for(let a=e;a!==i;a+=h)n.push(t+a.toString().padStart(r,"0")+s);return this.getFrames(n)}}function _(t){return class extends t{constructor(){super(...arguments),this.hasTexture=!1,this._prevTextureID=-1}setTexture(t,e){return this.texture=t instanceof E?t:this.scene.textures.get(t),this.texture?this.setFrame(e):console.warn("Invalid Texture key: "+t),this}setFrame(t){const e=this.texture.get(t);if(e===this.frame)return this;this.frame=e,this.setSize(e.sourceSizeWidth,e.sourceSizeHeight),e.pivot&&this.setOrigin(e.pivot.x,e.pivot.y);const i=this.vertexData;return i[2]=e.u0,i[3]=e.v0,i[8]=e.u0,i[9]=e.v1,i[14]=e.u1,i[15]=e.v1,i[20]=e.u1,i[21]=e.v0,this.setDirty(),this.hasTexture=!0,this}}}function b(t){return class extends t{constructor(...t){super(t),this.localTransform={a:1,b:0,c:0,d:1,tx:0,ty:0},this.worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0}}updateCache(){const t=this.localTransform,{rotation:e,skewX:i,skewY:r,scaleX:s,scaleY:n}=this;return t.a=Math.cos(e+r)*s,t.b=Math.sin(e+r)*s,t.c=-Math.sin(e-i)*n,t.d=Math.cos(e-i)*n,this.updateTransform()}updateTransform(){this.setDirty();const t=this.parent,e=this.localTransform,i=this.worldTransform;if(e.tx=this.x,e.ty=this.y,!t)return i.a=e.a,i.b=e.b,i.c=e.c,i.d=e.d,i.tx=e.tx,i.ty=e.ty,this;const r=t.worldTransform;let{a:s,b:n,c:h,d:a,tx:o,ty:c}=e;return i.a=s*r.a+n*r.c,i.b=s*r.b+n*r.d,i.c=h*r.a+a*r.c,i.d=h*r.b+a*r.d,i.tx=o*r.a+c*r.c+r.tx,i.ty=o*r.b+c*r.d+r.ty,this}localToGlobal(t,e,i=new d){return function(t,e,i,r=new d){const{a:s,b:n,c:h,d:a,tx:o,ty:c}=t;return r.x=s*e+h*i+o,r.y=n*e+a*i+c,r}(this.worldTransform,t,e,i)}globalToLocal(t,e,i=new d){return function(t,e,i,r=new d){const{a:s,b:n,c:h,d:a,tx:o,ty:c}=t,u=1/(s*a+h*-n);return r.x=a*u*e+-h*u*i+(c*h-o*a)*u,r.y=s*u*i+-n*u*e+(-c*s+o*n)*u,r}(this.worldTransform,t,e,i)}}}function R(t){return class extends t{constructor(){super(...arguments),this.visible=!0}setVisible(t){return this.visible=t,this}}}class C extends(a(class{},[o,u,x,l,f,m,T,v,A,w,S,b,R])){constructor(t,e=0,i=0){super(),this.scene=t,this._position.set(e,i),this.dirty=!0}}class L extends C{constructor(t,e=0,i=0){super(t,e,i),this.renderer=t.game.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.setSize(this.renderer.width,this.renderer.height)}updateTransform(){this.dirtyFrame=this.scene.game.frame;const t=this.localTransform,e=this.worldTransform;t.tx=this.x,t.ty=this.y;const i=this.matrix,{a:r,b:s,c:n,d:h,tx:a,ty:o}=t,c=this.renderer.width*this.originX,u=this.renderer.height*this.originY;return i[0]=r,i[1]=s,i[4]=n,i[5]=h,i[12]=r*-c+n*-u+(c+a),i[13]=s*-c+h*-u+(u+o),e.a=r,e.b=s,e.c=n,e.d=h,e.tx=i[12],e.ty=i[13],this}}class F extends(a(C,[c])){constructor(t,e=0,i=0){super(),this.setScene(t),this.setPosition(e,i)}update(t,e){const i=this.children;for(let r=0;r<i.length;r++)i[r].update(t,e)}preRender(t,e){const i=this.scene.game;i.totalFrame++,this.dirtyFrame>=i.frame&&i.dirtyFrame++;const r=this.children;for(let t=0;t<r.length;t++);}updateTransform(){super.updateTransform();const t=this.children;for(let e=0;e<t.length;e++)t[e].updateTransform();return this}}class z extends F{constructor(t){super(t),this.renderList=[]}scanChildren(t){const e=t.getChildren();for(let t=0;t<e.length;t++)this.buildRenderList(e[t])}buildRenderList(t){const e=this.scene.game;t.willRender()&&(this.renderList.push(t),t.dirtyFrame>=e.frame&&e.dirtyFrame++),t.isParent&&this.scanChildren(t)}preRender(){return this.renderList=[],this.scanChildren(this),this.renderList}update(t,e){const i=this.children;for(let r=0;r<i.length;r++)i[r].update(t,e)}}class B{constructor(t){this.game=t,this.load=t.loader,this.textures=t.textures,this.world=new z(this),this.camera=new L(this,0,0)}init(){}preload(){}create(){}update(t,e){}}class I{constructor(t){this.game=t,this.textures=new Map}get(t){return this.textures.has(t)?this.textures.get(t):this.textures.get("__MISSING")}addImage(t,e){let i=null;return this.textures.has(t)||(i=new E(t,e),i.glTexture=this.game.renderer.createGLTexture(i.image),this.textures.set(t,i)),i}addSpriteSheet(t,e,i){let r=null;return this.textures.has(t)||(r=new E(t,e),r.glTexture=this.game.renderer.createGLTexture(r.image),function(t,e,i,r,s,n){let{frameWidth:h=null,frameHeight:a=null,startFrame:o=0,endFrame:c=-1,margin:u=0,spacing:d=0}=n;if(a||(a=h),null===h)throw new Error("TextureManager.SpriteSheet: Invalid frameWidth given.");let l=Math.floor((r-u+d)/(h+d))*Math.floor((s-u+d)/(a+d));0===l&&console.warn("SpriteSheet frame dimensions will result in zero frames."),(o>l||o<-l)&&(o=0),o<0&&(o=l+o),-1!==c&&(l=o+(c+1));let x=u,f=u,g=0,p=0;for(let n=0;n<l;n++){g=0,p=0;let o=x+h,c=f+a;o>r&&(g=o-r),c>s&&(p=c-s),t.add(n,e+x,i+f,h-g,a-p),x+=h+d,x+h>r&&(x=u,f+=a+d)}}(r,0,0,r.width,r.height,i),this.textures.set(t,r)),r}addAtlas(t,e,i){let r=null;return this.textures.has(t)||(r=new E(t,e),r.glTexture=this.game.renderer.createGLTexture(r.image),function(t,e){let i;if(Array.isArray(e.textures)?i=e.textures[0].frames:Array.isArray(e.frames)?i=e.frames:e.hasOwnProperty("frames")?i=Object.values(e.frames):console.warn("Invalid Texture Atlas JSON"),i){let e;for(let r=0;r<i.length;r++){let s=i[r];e=t.add(s.filename,s.frame.x,s.frame.y,s.frame.w,s.frame.h),s.trimmed?e.setTrim(s.sourceSize.w,s.sourceSize.h,s.spriteSourceSize.x,s.spriteSourceSize.y,s.spriteSourceSize.w,s.spriteSourceSize.h):e.setSourceSize(s.sourceSize.w,s.sourceSize.h),s.rotated,s.anchor&&e.setPivot(s.anchor.x,s.anchor.y)}}}(r,i),this.textures.set(t,r)),r}addColor(t,e,i=32,r=32){return this.addGrid(t,e,e,i,r,0,0)}addGrid(t,e,i,r=32,s=32,n=2,h=2){let a=null;if(!this.textures.has(t)){const o=this.createCanvas(r,s),c=r/n,u=s/h;o.fillStyle=e,o.fillRect(0,0,r,s),o.fillStyle=i;for(let t=0;t<h;t++)for(let e=t%2;e<n;e+=2)o.fillRect(e*c,t*u,c,u);a=new E(t,o.canvas),a.glTexture=this.game.renderer.createGLTexture(a.image),this.textures.set(t,a)}return a}createCanvas(t,e){const i=document.createElement("canvas");return i.width=t,i.height=e,i.getContext("2d")}}class U{constructor(t,e,i=!1){this.callback=t,this.context=e,this.once=i}}class P extends class{constructor(){this._events=new Map}on(t,e,i=this,r=!1){if("function"!=typeof e)throw new TypeError("The listener must be a function");const s=new U(e,i,r),n=this._events.get(t);return n?n.add(s):this._events.set(t,new Set([s])),this}once(t,e,i=this){return this.on(t,e,i,!0)}clearEvent(t){return this._events.delete(t),this}eventNames(){return[...this._events.keys()]}listeners(t){const e=[];return this._events.get(t).forEach(t=>{e.push(t.callback)}),e}listenerCount(t){const e=this._events.get(t);return e?e.size:0}emit(t,...e){if(!this._events.has(t))return!1;const i=this._events.get(t);for(const t of i)t.callback.apply(t.context,e),t.once&&i.delete(t);return 0===i.size&&this._events.delete(t),!0}off(t,e,i,r){if(e){const s=this._events.get(t),n=!i,h=void 0!==r;for(const t of s)t.callback===e&&n&&t.context===console&&h&&t.once===r&&s.delete(t);0===s.size&&this._events.delete(t)}else this._events.delete(t);return this}removeAllListeners(t){t?this._events.delete(t):this._events.clear()}}{constructor(t){super(),this.VERSION="4.0.0-beta2",this.isPaused=!1,this.isBooted=!1,this.lifetime=0,this.elapsed=0,this.frame=0,this.dirtyFrame=0,this.totalFrame=0;const{width:e=800,height:i=600,backgroundColor:r=0,parent:s=document.body,scene:n=new B(this)}=t;this.scene=n,function(t){if("complete"===document.readyState||"interactive"===document.readyState)return void t();const e=()=>{document.removeEventListener("deviceready",e,!0),document.removeEventListener("DOMContentLoaded",e,!0),window.removeEventListener("load",e,!0),t()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",e,!0):(document.addEventListener("DOMContentLoaded",e,!0),window.addEventListener("load",e,!0)):window.setTimeout(e,20)}(()=>this.boot(e,i,r,s))}pause(){this.isPaused=!0,this.emit("pause")}resume(){this.isPaused=!1,this.lastTick=Date.now(),this.emit("resume")}boot(t,e,i,r){this.isBooted=!0,this.lastTick=Date.now(),this.textures=new I(this),this.loader=new h(this);const n=new s(t,e);n.setBackgroundColor(i),function(t,e){let i;if(e)"string"==typeof e?i=document.getElementById(e):"object"==typeof e&&1===e.nodeType&&(i=e);else if(t.parentElement)return t;i||(i=document.body),i.appendChild(t)}(n.canvas,r),this.renderer=n,this.banner(this.VERSION),document.addEventListener("visibilitychange",()=>{this.emit("visibilitychange",document.hidden),document.hidden?this.pause():this.resume()});const a=this.scene;a instanceof B?this.scene=this.createSceneFromInstance(a):"object"==typeof a?this.scene=this.createSceneFromObject(a):"function"==typeof a&&(this.scene=this.createSceneFromFunction(a)),this.scene.init(),this.emit("boot"),this.scene.preload(),this.loader.totalFilesToLoad()>0?this.loader.start(()=>this.start()):this.start()}createSceneFromInstance(t){return t.game=this,t.load=this.loader,t}createSceneFromObject(t){let e=new B(this);return["init","preload","create","update","render"].forEach(i=>{t.hasOwnProperty(i)&&(e[i]=t[i])}),e}createSceneFromFunction(t){var e=new t(this);return e instanceof B?this.createSceneFromInstance(e):e}start(){this.scene.create(),requestAnimationFrame(()=>this.step())}banner(t){console.log("%c  %c  %cPhaser Nano v"+t+"%c https://phaser4.io","padding: 2px; background: linear-gradient(to right, #00bcc3, #3e0081)","padding: 2px; background: #3e0081 url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJ1BMVEUALon///+9tJQAAABv9v92d2IAn6qHEhL/DQ3/fCUOOlNMPUD/uz24pItZAAAAaElEQVQI12OAA/YCKKPyOANbWgKQUdFZkOLiBmJ0zHIRdAEKWXR0uQimABnWu3elpIEYhoKCYS4ui8EModBQRQMG09AgQSBQBmpvBzOABhYpAYEBg3FpEJAOZgCqAdEGDAzGIACk4QAAsv0aPCHrnowAAAAASUVORK5CYII=) no-repeat;","padding: 2px 20px 2px 8px; color: #fff; background: linear-gradient(to right, #3e0081 90%, #3e0081 10%, #00bcc3)","")}step(){const t=Date.now(),e=(t-this.lastTick)/1e3;this.lifetime+=e,this.elapsed=e,this.lastTick=t,this.emit("step",e,t),this.isPaused||(this.scene.update(e,t),this.scene.world.update(e,t)),this.emit("update",e,t),this.dirtyFrame=0,this.totalFrame=0;const i=this.scene.world.preRender();this.renderer.render(i,this.scene.camera,this.dirtyFrame),this.emit("render",e,t),this.frame++,requestAnimationFrame(()=>this.step())}}function k(t,e){return((255&(255*e|0))<<24|t)>>>0}class D extends(a(C,[c,g,p,_])){constructor(t,e,i,r,s){super(),this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.setScene(t),this.setTexture(r,s),this.setPosition(e,i)}packColors(){const t=this.vertexAlpha,e=this.vertexTint,i=this.vertexColor;return i[0]=k(e[0],t[0]),i[1]=k(e[1],t[1]),i[2]=k(e[2],t[2]),i[3]=k(e[3],t[3]),this.setDirty(),this}updateVertices(t,e,i){const r=this.vertexData;if(this.dirty){this.dirty=!1;const t=this.frame,e=this._origin;let i,s,n,h;const{a:a,b:o,c:c,d:u,tx:d,ty:l}=this.worldTransform;t.trimmed?(s=t.spriteSourceSizeX-e.x*t.sourceSizeWidth,i=s+t.spriteSourceSizeWidth,h=t.spriteSourceSizeY-e.y*t.sourceSizeHeight,n=h+t.spriteSourceSizeHeight):(s=-e.x*t.sourceSizeWidth,i=s+t.sourceSizeWidth,h=-e.y*t.sourceSizeHeight,n=h+t.sourceSizeHeight),r[0]=s*a+h*c+d,r[1]=s*o+h*u+l,r[6]=s*a+n*c+d,r[7]=s*o+n*u+l,r[12]=i*a+n*c+d,r[13]=i*o+n*u+l,r[18]=i*a+h*c+d,r[19]=i*o+h*u+l}const s=this.texture.glIndex;s!==this._prevTextureID&&(this._prevTextureID=s,r[4]=s,r[10]=s,r[16]=s,r[22]=s),t.set(r,i);const n=this.vertexColor;e[i+5]=n[0],e[i+11]=n[2],e[i+17]=n[3],e[i+23]=n[1]}}class M extends B{constructor(t){super(t)}preload(){this.load.setPath("../assets/"),this.load.image("logo","logo.png"),this.load.image("clown","clown.png")}create(){const t=new D(this,400,300,"logo");this.world.addChild(t),console.log(t),this.sprite=t,document.body.addEventListener("click",()=>{let t=50+700*Math.random(),e=50+500*Math.random();this.world.addChild(new D(this,t,e,"clown"))})}update(){this.sprite.rotation+=.01}}new P({width:800,height:600,backgroundColor:51,parent:"gameParent",scene:M})}();
